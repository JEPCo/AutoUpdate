apply plugin: 'com.android.library'
apply plugin: 'com.jfrog.artifactory'
apply plugin: 'maven-publish'

def repo_context_url = hasProperty('artifactory_context_url') ? artifactory_context_url : System.getenv('artifactory_context_url')
def repo_username = hasProperty('artifactory_username') ? artifactory_username : System.getenv('artifactory_username')
def repo_password = hasProperty('artifactory_password') ? artifactory_password : System.getenv('artifactory_password')
def repo_key = hasProperty('artifactory_key') ? artifactory_key : System.getenv('artifactory_key')
def VERSION_NAME = System.getenv('BUILD_NUMBER') ? System.getenv('BUILD_NUMBER') : "1.4.0"

ext {
    bintrayRepo = 'maven'
    bintrayName = 'android-update-apk'

    publishedGroupId = 'com.artwl'
    libraryName = 'Android-Update-Apk'
    artifact = 'android-update-apk'

    libraryDescription = 'Android update checker,download and install apk file'

    siteUrl = 'https://github.com/artwl/android-update-apk'
    gitUrl = 'https://github.com/artwl/android-update-apk.git'

    libraryVersion = '0.0.1'

    developerId = 'artwl'
    developerName = 'Artwl'
    developerEmail = 'artwl@outlook.com'

    licenseName = 'The Apache Software License, Version 2.0'
    licenseUrl = 'http://www.apache.org/licenses/LICENSE-2.0.txt'
    allLicenses = ["Apache-2.0"]
}

dependencies {
    compile 'com.android.support:support-v4:23.1.0'

    // Guava
    provided 'com.google.guava:guava:20.0+'
    provided 'com.google.code.gson:gson:2.8.0'
    provided 'com.squareup.okhttp3:okhttp:3.4.1'
    provided 'com.squareup.okio:okio:1.11.0'

    // OkHttp
    compile 'com.squareup.okhttp3:okhttp:3.3.1'
}

android {
    compileSdkVersion 23
    buildToolsVersion '23.0.3'

    defaultConfig {
        minSdkVersion 8
        targetSdkVersion 23
        versionCode 1
        versionName VERSION_NAME
    }
    buildTypes {
        release {
            minifyEnabled false
        }
    }
    lintOptions {
        abortOnError false
    }
}

def libraryGroupId = 'com.conouch.view'
def libraryArtifactId = 'auto-update'
def libraryVersion = VERSION_NAME

publishing {
    publications {
        aar(MavenPublication) {
            groupId libraryGroupId
            version libraryVersion
            artifactId libraryArtifactId

            artifact("$buildDir/outputs/aar/${project.name}-release.aar")
        }
    }
}

artifactory {
    contextUrl = repo_context_url
    publish {
        repository {
            repoKey = repo_key

            username = repo_username
            password = repo_password
        }
        defaults {
            publications('aar')
            publishArtifacts = true

            properties = ['qa.level': 'basic', 'q.os': 'android', 'dev.team': 'core']
            publishPom = true
        }
    }
}
